/*
IntervalMap.js v0.0.3 8/22/2025
https://github.com/rawify/IntervalMap.js

Copyright (c) 2025, Robert Eisele (https://raw.org/)
Licensed under the MIT license.
*/
'use strict';(function(w){function q(a,b){this.i=a;this.v=b;this.m=a.b;this.h=1;this.r=this.l=null}function p(a){return a?a.h:0}function m(a){var b=p(a.l);const d=p(a.r);a.h=(b>d?b:d)+1;b=a.i.b;a.l&&a.l.m>b&&(b=a.l.m);a.r&&a.r.m>b&&(b=a.r.m);a.m=b;return a}function r(a){return p(a.l)-p(a.r)}function u(a){const b=a.r,d=b.l;b.l=a;a.r=d;m(a);return m(b)}function v(a){const b=a.l,d=b.r;b.r=a;a.l=d;m(a);return m(b)}function t(a){const b=r(a);return 1<b?(0>r(a.l)&&(a.l=u(a.l)),v(a)):-1>b?(0<r(a.r)&&(a.r=
v(a.r)),u(a)):a}function k(){this.root=null;this.size=0}k.prototype={constructor:k,set:function(a,b){function d(c){if(!c)return g.size++,new q(a,b);const e=a.compareTo(c.i);if(0>e)c.l=d(c.l);else if(0<e)c.r=d(c.r);else return c.v=b,c;return t(m(c))}if(!(a instanceof Interval))throw Error("IntervalMap.set expects Interval");const g=this;this.root=d(this.root);return this},get:function(a){if(!(a instanceof Interval))throw Error("IntervalMap.get expects Interval");let b=this.root;const d=a.a;for(a=a.b;b;){const g=
b.i;if(d<g.a)b=b.l;else if(d>g.a)b=b.r;else{if(a===g.b)return b.v;b=a<g.b?b.l:b.r}}return null},"delete":function(a){function b(c){for(;c.l;)c=c.l;return c}function d(c){if(!c)return null;const e=a.compareTo(c.i);if(0>e)c.l=d(c.l);else if(0<e)c.r=d(c.r);else if(g=!0,c.l&&c.r){const h=b(c.r);c.i=h.i;c.v=h.v;c.r=function x(f,n){if(!f)return null;if(f===h)return f.r;f.l=x(f.l,n);return t(m(f))}(c.r,h)}else c=(c=c.l?c.l:c.r)?c:null;return c?t(m(c)):null}if(!(a instanceof Interval))throw Error("IntervalMap.delete expects Interval");
let g=!1;this.root=d(this.root);g&&this.size--;return g},hasOverlap:function(a){if(!(a instanceof Interval))throw Error("IntervalMap.hasOverlap expects Interval");let b=this.root;const d=a.a;for(a=a.b;b;){const g=b.i;if(g.a<=a&&d<=g.b)return!0;b=b.l&&b.l.m>=d?b.l:b.r}return!1},getOverlapping:function(a){function b(e){if(e){e.l&&e.l.m>=g&&b(e.l);var h=e.i;h.a<=c&&g<=h.b&&d.push({interval:h,value:e.v});e.r&&e.i.a<=c&&b(e.r)}}if(!(a instanceof Interval))throw Error("IntervalMap.getOverlapping expects Interval");
const d=[],g=a.a,c=a.b;b(this.root);return d},getAt:function(a,b=!1){if(b){const d=[];function g(c){if(c){c.l&&c.l.m>=a&&g(c.l);var e=c.i;e.a<=a&&a<=e.b&&d.push({interval:e,value:c.v});c.r&&e.a<=a&&g(c.r)}}g(this.root);return d}for(b=this.root;b;){const d=b.i.b;if(a<b.i.a)b=b.l;else if(a>d)b=b.r;else return b.v}return null},getSize:function(){return this.size},isEmpty:function(){return 0===this.size},clear:function(){this.root=null;this.size=0;return this},forEach:function(a){let b=[],d=this.root;
for(;b.length||d;){for(;d;)b.push(d),d=d.l;d=b.pop();a(d.i,d.v);d=d.r}return this},toArray:function(){const a=[];this.forEach(function(b,d){a.push({interval:b,value:d})});return a},toString:function(){const a=[];this.forEach(function(b,d){a.push("["+b.a+", "+b.b+"] -> "+d)});return a.join(", ")},clone:function(){function a(d){if(!d)return null;const g=new q(new Interval(d.i.a,d.i.b),d.v);g.l=a(d.l);g.r=a(d.r);g.h=d.h;g.m=d.m;return g}const b=new k;b.root=a(this.root);b.size=this.size;return b}};k.fromArray=
function(a,b){function d(e,h){if(e>h)return null;const l=e+h>>1;var f=c[l];f=new q(f.interval,f.value);f.l=d(e,l-1);f.r=d(l+1,h);e=f.l?f.l.h:0;h=f.r?f.r.h:0;f.h=(e>h?e:h)+1;e=f.i.b;f.l&&f.l.m>e&&(e=f.l.m);f.r&&f.r.m>e&&(e=f.r.m);f.m=e;return f}const g=new k;if(!a||0===a.length)return g;let c=a.slice();c.sort(function(e,h){const l=e.interval,f=h.interval;return l.a!==f.a?l.a-f.a:l.b!==f.b?l.b-f.b:b?e.value<h.value?-1:e.value>h.value?1:0:0});if(b){a=[];for(let e=0;e<c.length;e++){const h=c[e].interval,
l=c[e].value;if(0===a.length){a.push({interval:h.clone(),value:l});continue}const f=a[a.length-1],n=f.interval;f.value===l&&h.a<=n.b?h.b>n.b&&(n.b=h.b):a.push({interval:h.clone(),value:l})}c=a}g.root=d(0,c.length-1);g.size=c.length;return g};"function"===typeof define&&define.amd?define([],function(){return k}):"object"===typeof exports?(Object.defineProperty(k,"__esModule",{value:!0}),k["default"]=k,k.IntervalMap=k,module.exports=k):w.IntervalMap=k})(this);
